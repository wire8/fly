pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
function _init()
 game_over=false
 win=false
 g = 0.025 --gravity
 music(0)
 make_player()
 make_ground()
end

function _update()
	if(not game_over) then
		move_player()
		check_land()
	else
		if (btnp(5)) _init()
	end
end

function check_land()
 l_x=flr(p.x)   --left side of ship
 r_x=flr(p.x+7) --right side of ship
 b_y=flr(p.y+7) --bottom of ship
 over_pad=l_x>=pad.x and r_x<=pad.x+pad.width
 on_pad=b_y>=pad.y-1
 slow=p.dy<1
 if (over_pad and on_pad and slow) then
  end_game(true)
 elseif (over_pad and on_pad) then
  end_game(false)
 else
  for i=l_x,r_x do
   if (gnd[i]<=b_y) end_game(false)
  end
 end 
end

function end_game(won)
 game_over=true
 win=won

 if (win) then
  music(-1,100)
  music(1)
  music(2)
 else
  music(-1,100)
  sfx(2)
 end
end

function move_player()
 p.dy+=g --add gravity
	
 thrust()
	
 p.x+=p.dx --actually move
 p.y+=p.dy --the player

 stay_on_screen()
end

function stay_on_screen()
 if (p.x<0) then --left side
  p.x=0
  p.dx=0 
 end
 if (p.x>119) then --right side
  p.x=119
  p.dx=0
 end
 if (p.y<0) then
  p.y=0
  p.dy=0 
 end
end

function thrust()
 --add thrust to movement
 if (btn(0)) p.dx-=p.thrust
 if (btn(1)) p.dx+=p.thrust
 if (btn(2)) p.dy-=p.thrust

 --thrust sound
 if (btn(0) or btn(1) or btn(2)) sfx(0)
end

function _draw()
 cls()
 draw_stars()
 draw_ground()
 draw_player()

 if (game_over) then
  if (win) then
   print("you win!",48,48,11)
  else
   print("too bad!",48,48,8)
  end
  print("press �❎ to play again",20,70,5) 
 end
end

function rndb(low, high)
 return flr(rnd(high-low+1)+low)
end

function draw_stars()
 srand(1)
 for i=1,50 do
  pset(rndb(0,127), rndb(0,127), rndb(5,7))
 end
 srand(time())
end

function make_ground()
 --create the ground
 gnd={}
 local top=96  --highest point
 local btm=120 --lowest point
 --set up the landing pad
 pad={}
 pad.width=15
 pad.x=rndb(0,126-pad.width)
 pad.y=rndb(top,btm)
 pad.sprite=2
 --create ground at pad
 for i=pad.x,pad.x+pad.width do
  gnd[i]=pad.y
 end
 --create ground right of pad
 for i=pad.x+pad.width+1,127 do
  local h=rndb(gnd[i-1]-3,gnd[i-1]+3)
  gnd[i]=mid(top,h,btm)
 end
 --create ground left of pad
 for i=pad.x-1,0,-1 do
  local h=rndb(gnd[i+1]-3,gnd[i+1]+3)
  gnd[i]=mid(top,h,btm)
 end
end

function draw_ground()
 for i=0,127 do
  line(i,gnd[i],i,127,5)
 end
 spr(pad.sprite,pad.x,pad.y,2,1)
end

function make_player()
 p = {}
 p.x = 60 --position
 p.y = 8
 p.dx = 0 --movement 
 p.dy = 0
 p.sprite = 1
 p.alive = true
 p.thrust = 0.075
end

function draw_player()
 spr(p.sprite, p.x, p.y)
 if (game_over and win) then
  spr(4,p.x,p.y-8) --flag
  spr(6,p.x-8,p.y) --astro
 elseif (game_over) then
  spr(5,p.x,p.y) --explosion
 end
end

__gfx__
0000000000666600761dddddddddd766000000000088880000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066c76607666666666666666000000000899998000777000000000000000000000000000000000000000000000000000000000000000000000000000
0070070066ccc766076666666666660000000000899aa998007ff000000000000000000000000000000000000000000000000000000000000000000000000000
0007700066cccc660000000000000000000b600089aaaa98007ff000000000000000000000000000000000000000000000000000000000000000000000000000
0007700066555566000000000000000000bb600089aaaa9800636000000000000000000000000000000000000000000000000000000000000000000000000000
007007000666666000000000000000000bbb6000899aa99800666600000000000000000000000000000000000000000000000000000000000000000000000000
00000000050550500000000000000000000060000899998000707000000000000000000000000000000000000000000000000000000000000000000000000000
00000000660660660000000000000000000060000088880000707000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000600000b56022600067000000000000177000000000000000002570000000000001770000000007000d70000000000000000000000000000000000000000000000000000000000000000000000000000000000
000c00001b0701b030180701803011070110301d0701d03000000190701d0701d0300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000a00003f6703c6603b6503864034640326302f6302c6302862025620226201f6201c6101861015610126100f6100c6100861006610026100161000000000000000000000000000000000000000000000000000
0013000d25020050201d0200502027020050201d02004020370202002019020130200c02000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000c00000e0300370010700107001503004700117001a03013700117000f70012700150301a0001a030107000c030000000000000000130300000000000180300000000000000000000013030000001803000000
000c00002433000000243300000024330000000000024330000002433000000000002433000000243300000023330000002333000000233300000000000233300000023330000000000023330000002333000000
000c00001d330000001d330000001d330000001a3301d330000001d330000001a3301d3301d3301d330000001c330000001c330000001c33000000183301c330000001c33000000183301c330183301c33000000
000c00000c0333f215000003f2153c610000003f2153f2150c0333f215000003f2153c6103f215000003f2150c0333f2153f215000003c6103f215000003f2150c0333f215000003f2153c6103f2153f2153f215
0010000013334183341c3341f33424334283342b3342b3302b33028320283202832014334183341b3342033424334273342c3342c3302c330273202732027320163301a3341d3342233426334293342e3342e330
00100000000001032013320183201c3201f3202432024320243201f3201f3201f3201f0000f33014330183301b330203302432024320243202032020320203200000011330163301a3301d330223302633026330
011000000000000000000000c03410034130341c0301c0301c0301803000000000000000000000000000c0340f034140341b0301b0301b0301803000000000000000000000000000e03411034160341d0301d030
00100000000002e3352e3352e33530330303303033030325000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000026330263302633028330283302833028320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000000001a0351a0351a03518030180301803018025000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
03 04050607
00 08090a44
00 0b0c0d44
00 41424344
00 41424344
03 41424344

