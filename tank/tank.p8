pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
top = 2
right = 1
bottom = 3
left = 0

function _init()
  make_player()
  make_bullet()
  make_enemy()
end

function _update()
  move_player()
  move_bullet()
  move_enemy()
  check_collisions()
  fire()
end

function _draw()
  cls()
  camera(player.x-64, player.y-64)
  draw_level()
  draw_player()
  draw_bullet()
  draw_enemy()
end

function draw_level()
 map(0, 0, 48, 28, 100,100)
end

function make_player()
  player={}
  player.cannon={}
  player.x=128
  player.y=128
  player.direction=top
  player.sprite=0
  player.speed=1
  player.alive=true

  player.cannon.sprite=32
end

function make_bullet()
  bullet={}
  bullet.x=0
  bullet.y=0
  bullet.sprite=1
  bullet.speed=5
  bullet.direction=player.direction
  bullet.alive=false
end

function make_enemy()
  enemy={}
  enemy.x=0
  enemy.y=0
  enemy.direction=bottom
  enemy.sprite=64
  enemy.speed=1
  enemy.alive=true
end

function draw_player()
  if (not player.alive) then
    return
  end
  if (player.direction==top) then
    spr(player.sprite,player.x,player.y, 2,2)
    spr(player.cannon.sprite,player.x,player.y, 2,2)
  elseif (player.direction==bottom) then
    spr(player.sprite,player.x,player.y, 2,2, false, true)
    spr(player.cannon.sprite,player.x,player.y, 2,2, false, true)
  elseif (player.direction==left) then
    spr(player.sprite + 4,player.x,player.y, 2,2, true)
    spr(player.cannon.sprite + 4,player.x,player.y, 2,2, true)
  elseif (player.direction==right) then
    spr(player.sprite + 4,player.x,player.y, 2,2, false, true)
    spr(player.cannon.sprite + 4,player.x,player.y, 2,2, false, true)
  end
end

function draw_bullet()
  if (bullet.alive) then
    spr(bullet.sprite,bullet.x,bullet.y)
  end
end

function draw_enemy()
  if (enemy.alive) then
    spr(enemy.sprite,enemy.x,enemy.y)
  end
end

function move_player()
  if (btn(left)) then
    move_left(player)
  elseif (btn(right)) then
    move_right(player)
  elseif (btn(top)) then
    move_up(player)
  elseif (btn(bottom)) then
    move_down(player)
  end
end

function move_bullet()
  if (bullet.x > (128 + player.x) or bullet.x < 0 or
      bullet.y > (128 + player.y) or bullet.y < 0) then
    bullet.alive = false
  end

  if (bullet.alive) then
    if (bullet.direction == top) move_up(bullet)
    if (bullet.direction == bottom) move_down(bullet)
    if (bullet.direction == left) move_left(bullet)
    if (bullet.direction == right) move_right(bullet)
  end
end

function move_enemy()
  if (enemy.x < player.x) then
    move_right(enemy)
  elseif (enemy.x > player.x) then
    move_left(enemy)
  elseif (enemy.y < player.y) then
    move_down(enemy)
  elseif (enemy.y > player.y) then
    move_up(enemy)
  end
end

function move_up(obj)
  obj.y-=obj.speed
  obj.direction = top
end

function move_down(obj)
  obj.y+=obj.speed
  obj.direction = bottom
end

function move_left(obj)
  obj.x-=obj.speed
  obj.direction = left
end

function move_right(obj)
  obj.x+=obj.speed
  obj.direction = right
end

function check_collisions() 
  if (bullet.alive and is_close(bullet, enemy)) then
    bullet.alive = false
    kill_enemy()
  end
  if (is_close(player, enemy)) then
    player.alive = false
  end
end

function is_close(obj1, obj2)
  if (abs(obj1.x - obj2.x) <= 3 and abs(obj1.y - obj2.y) <= 3) then
    return true
  end
  return false
end

function kill_enemy()
  enemy.x=0
  enemy.y=0
  enemy.direction=bottom
end

function fire()
  if (btn(4) and not bullet.alive) then
    bullet.alive=true
    bullet.x = player.x
    bullet.y = player.y - 5
    bullet.direction = player.direction
  end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666000000666000066600000066600005566556655660000655665566556000066556655665500006556655665560000555333333555000066633333366600
0066bbbbbbbb66000055bbbbbbbb550000556655665566000065566556655600006655665566550000655665566556000055b333333b55000055b333333b5500
0055bb3333bb55000055bb3333bb5500005bbbbbbbbbb600006bbbbbbbbbb600006bbbbbbbbbb500006bbbbbbbbbb6000066bbbbbbbb66000055bbbbbbbb5500
0055b335533b55000066b335533b66000033bb33333bb0000033bb33333bb000000bb33333bb3300000bb33333bb33000066bb3333bb66000066bb3333bb6600
0066b355553b66000066b355553b66000033b3355533b0000033b3355533b000000b3355533b3300000b3355533b33000055b335533b55000066b335533b6600
0066b355553b66000055b355553b55000033b3555553b0000033b3555553b000000b3555553b3300000b3555553b33000055b355553b55000055b355553b5500
0055b355553b55000055b355553b55000033b3555553b0000033b3555553b000000b3555553b3300000b3555553b33000066b355553b66000055b355553b5500
0055b335533b55000066b335533b66000033b3355533b0000033b3355533b000000b3355533b3300000b3355533b33000066b355553b66000066b355553b6600
0066bb3333bb66000066bb3333bb66000033bb33333bb0000033bb33333bb000000bb33333bb3300000bb33333bb33000055b335533b55000066b335533b6600
0066bbbbbbbb66000055bbbbbbbb5500005bbbbbbbbbb600006bbbbbbbbbb600006bbbbbbbbbb500006bbbbbbbbbb6000055bb3333bb55000055bb3333bb5500
0055b333333b55000055b333333b550000556655665566000065566556655600006655665566550000655665566556000066bbbbbbbb66000055bbbbbbbb5500
00555333333555000066633333366600005566556655660000655665566556000066556655665500006556655665560000666000000666000066600000066600
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000
00000033330000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000
00000003300000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000033300000000000
00000003300000000000000000003330000000000000000000000000000000000000003333000000000000333300000000000000000000000303330000000000
00000003300000000000000000033303000000000000000000000000000000000000033553300000000003355330000000000000000000000000333300000000
00000003300000000000000003333000000033333000000000003333300000000000035555300000000003555530000000000003333300000000033333330000
00000033330000000000003333330000000335553300003000033555330000000000035555300000000003555530000003000033555330000000033355533000
00000335533000000000033553330000000355555333333000035555530000000000035555300000000003555530000003333335555530000000003555553000
00000355553000000000035555300000000355555333333000035555530000000000033553300000000033355330000003333335555530000000003555553000
00000355553000000000035555300000000335553300003000033555333000000000003333000000000033333300000003000033555330000000003355533000
00000355553000000000035555300000000033333000000000003333333000000000000330000000000333300000000000000003333300000000000333330000
00000335533000000000033553300000000000000000000000000000333300000000000330000000303330000000000000000000000000000000000000000000
00000033330000000000003333000000000000000000000000000000003330300000000330000000033300000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000333000000000330000000003000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000030000000003333000000000300000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000
000aa000000aa000000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333300003333000033330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03099030030990300309903000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03999930039999300399993000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00434300004343000043430000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07443370074433700744337000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333400003334000033340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000aa000000aa000000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333000003330000033300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00093300000933000009330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00993300009933000099330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333000003330000033300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00373000003730000037300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555000005550000055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00070000007000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000aa000000aa000000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033300000333000003330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00339000003390000033900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00339900003399000033990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033300000333000003330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00037300000373000003730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055500000555000005550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007000000007000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000aa000000aa000000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00433300004333000043330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03344330033443300334433000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03344340033443400334434000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00443300004433000044330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07434370074343700743437000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333300003333000033330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00888800055555550000000055555555555555500000000055555550055555550000000000000000000000000000000000000000000000000000000000000000
08999980055555555555555555555555555555505555555055555550055555550555555500000000000000000000000000000000000000000000000000000000
899aa998055555555555555555555555555555505555555055555550055555550555555500000000000000000000000000000000000000000000000000000000
89aaaa98055555555555555555555555555555505555555055555550055555550555555500000000000000000000000000000000000000000000000000000000
89aaaa98055555555555555555555555555555505555555055555550055555550555555500000000000000000000000000000000000000000000000000000000
899aa998055555555555555555555555555555505555555055555550055555550555555500000000000000000000000000000000000000000000000000000000
08999980055555555555555555555555555555505555555055555550055555550555555500000000000000000000000000000000000000000000000000000000
00888800055555555555555500000000555555505555555000000000000000000555555500000000000000000000000000000000000000000000000000000000
99999999555555555555555099999999339999990000000068000000000000000000000000000000000000000000000000000000000000000000000000000000
99999999555555555555555099999993333999990000000068800000000000000000000000000000000000000000000000000000000000000000000000000000
99999999555555555555555099999933333999990000000068000000000000000000000000000000000000000000000000000000000000000000000000000000
99999999555555555555555099999333333399990000000060000000000000000000000000000000000000000000000000000000000000000000000000000000
99999999555555555555555099993333333339990000005555500000000000000000000000000000000000000000000000000000000000000000000000000000
99999999555555555555555099933333333339990000055555550000000000000000000000000000000000000000000000000000000000000000000000000000
99999999555555555555555099333333333333990000555555555000000000000000000000000000000000000000000000000000000000000000000000000000
99999999555555555555555093333333333333390005555555555500000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000033333333333333330055555999555550000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000033333333333333390555555999555555000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000093333333333333335555555999555555000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000093333333333333335555555999555555000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000009939394443433339dddddddddddddddd000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000099999944444999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000099999944444999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000099999944444999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
9090909090909090909090909093949090909090909090909090909090909090909090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909090909090909090a3a49090909394909090909090909394909394909090909090909090909090909394909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
909090909090909093949090909090909394a3a490939490909090a3a490a3a490909394909090888282859090a3a4909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9090908882828590a3a4909394909090a3a4909090a3a49093949090909090909090a3a49090908191918490909090939400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9090908191918490909090a3a49090909090909090909090a3a4909090909090909090909090908783838690909090a3a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9090908783838690909090909090909093949090909090909090909090939490909394909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909090909090909090909090a3a49090909090909090909090a3a49090a3a4909093949090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909090909090909090939490909090909090909090909090909090909090909090a3a49090909090909090939400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909090909093949090a3a49090909090909090909090909090909090909090909090909090909090909090a3a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
909090909090909090a3a4909090909090909090909090909090909090909090909090909090909090909090939490909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9090909090909090909090909090909090909090909093949090909090909090909090909090909090909090a3a490939400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909090909090909090909090909093949090a3a49090909090909090909090909090909090909090909090a3a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
909090909090909090909090909090909090a3a4909090909090909090909090909090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9090909090909090909090909090909090909090909093949093949090909090909090909090909090909090939490939400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909090909090909090909093949090939490a3a490a3a49090909090909090909090909090909090a3a490a3a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
909090909090888282859093949090a3a49090a3a49090909090909090909090909090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9090909090908191918490a3a490909090909090909090909090909090909090909090909090909090909090909093949000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909087838386909090909090909090909090909090909090909090909090909090909090909090909090a3a49000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9090909090909090909090909090909090909090909090909090909090909090909090909090909090909090939490909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9090909090909394909394909090909090909090909090909090909090909090909090909090909090909090a3a490909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
909090909090a3a490a3a4909090909090909090909090909090909394909093949090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
909090909090909090909090909090909090909090909090909090a3a49090a3a49090909090909088828285909093949000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909090909090909090909090909090909088828285909090909090909090909090909090819191849090a3a49000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9394909090909090909090909090909090909394908191918490909394909093949093949090909087838386909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a3a490909090909090909090909093949090a3a490878383869090a3a49090a3a490a3a49090909090909394909394909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9093949090909090909090939490a3a49090909090909090909090909090909090909090909093949090a3a490a3a4909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90a3a49093949090909090a3a490909090939490909090909394909394909090909394909090a3a490939490909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090a3a49093949090909090939490a3a49093949090a3a490a3a490909090a3a4909394909090a3a493949090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90909090909090a3a49090909090a3a490909090a3a49090909090909090909090909090a3a49090909394a3a49090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000a3a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000800200c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c6300c630
000400003e4503e450226501b65012650106500d6500a65008650066500565002650016500065000650006501660015600156000f600166000c6001660018600186000f6001a600166000f600186001860024600
000d000012450114501345010450114501345010450114501345013450104501145013450104501145013450134500f4501145013450104501145013450104501145013450104501145013450104501145013450
